- name: GPSD Setup
  block:
    - name: Disable GPSD
      systemd:
        name: "{{ item }}"
        state: stopped
        enabled: no
      become: true
      loop: 
        - skyhub-gpsd.service
        - skyhub-gpsd.socket
      ignore_errors: true
      
    - name: Sync system time with GPS Receiver
      lineinfile:
        path: /etc/chrony/chrony.conf
        state: present
        line: "{{ item }}"
      loop:
        - refclock SHM  0 delay 0.5 refid GPS

    - name: Enable GPSD
      systemd:
        name: "{{ item }}"
        state: restarted
        enabled: yes
        daemon_reload: yes
      become: true
      loop:
        - skyhub-gpsd.service
        - skyhub-gpsd.socket
