#!/bin/bash

echo "Initializing the Sky Hub Installer..."
GITBRANCH=master
TRACKERENV=prod
case $1 in

  dev)
    echo -n "Running dev environment"
    GITBRANCH=develop
    TRACKERENV=dev
    ;;

  test)
    echo -n "Running test environment"
    GITBRANCH=test
    TRACKERENV=test
    ;;

  staging)
    echo -n "Running staging / prod environment"
    GITBRANCH=develop
    TRACKERENV=prod
    ;;

  *)
    echo -n "Running prod environment"
    ;;
esac

apt-get -qq update 
apt-get install -qq -y git python3-pip

pip3 -q install ansible

ansible-galaxy collection install ansible.posix -p ~/.ansible/collections
ansible-galaxy collection install community.general -p ~/.ansible/collections

if [ -d ansible-tracker ]; then
	rm -rf ./ansible-tracker
fi

git clone -q https://gitlab.com/skyhuborg/ansible-tracker.git

cd ansible-tracker
git checkout $GITBRANCH

ansible-playbook $TRACKERENV.yml
#ANSIBLE_STDOUT_CALLBACK=actionable sudo -E ansible-playbook ansible-tracker/jetson.yaml

cd ..
rm -r ./ansible-tracker
rm ./install

#this is for when we go to production
