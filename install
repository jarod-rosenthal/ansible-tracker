#!/bin/bash

echo "Initializing the Sky Hub Installer..."

if [ -z "$1" ]; then
  echo "Running on master branch"
  GITBRANCH=master
else
  echo "Running on $1 branch"
  GITBRANCH=$1
fi

apt-get -qq update 
apt-get install -qq -y git
apt-get install -qq -y python3-pip

pip -q install ansible

ansible-galaxy collection install ansible.posix -p ~/.ansible/collections
ansible-galaxy collection install community.general -p ~/.ansible/collections

if [ -d ansible-tracker ]; then
	rm -rf ./ansible-tracker
fi

git clone -q https://gitlab.com/skyhuborg/ansible-tracker.git

cd ansible-tracker
git checkout $GITBRANCH

ansible-playbook jetson.yaml
#ANSIBLE_STDOUT_CALLBACK=actionable sudo -E ansible-playbook ansible-tracker/jetson.yaml

cd ..
rm -r ./ansible-tracker
rm ./install

#this is for when we go to production
